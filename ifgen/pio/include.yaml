---
includes_left:
  - pio_interrupt_cluster.yaml
  - pio_sm.yaml
structs:
  pio:
    description: |-
      Programmable IO block
    instances:
      - name: PIO0
        address: '0x50200000'
      - name: PIO1
        address: '0x50300000'
    fields:
      - name: CTRL
        type: uint32_t
        expected_size: 4
        expected_offset: 0
        description: |-
          (read-write) PIO control register
        fields:
          - name: SM_ENABLE
            description: |-
              Enable/disable each of the four state machines by writing 1/0 to each of these four bits. When disabled, a state machine will cease executing instructions, except those written directly to SMx_INSTR by the system. Multiple bits can be set/cleared at once to run/halt multiple state machines simultaneously.
            index: 0
            width: 4
            read: true
            write: true
          - name: SM_RESTART
            description: |-
              Write 1 to instantly clear internal SM state which may be otherwise difficult to access and will affect future execution.
                              Specifically, the following are cleared: input and output shift counters; the contents of the input shift register; the delay counter; the waiting-on-IRQ state; any stalled instruction written to SMx_INSTR or run by OUT/MOV EXEC; any pin write left asserted due to OUT_STICKY.
                              The program counter, the contents of the output shift register and the X/Y scratch registers are not affected.
            index: 4
            width: 4
            read: true
            write: true
          - name: CLKDIV_RESTART
            description: |-
              Restart a state machine's clock divider from an initial phase of 0. Clock dividers are free-running, so once started, their output (including fractional jitter) is completely determined by the integer/fractional divisor configured in SMx_CLKDIV. This means that, if multiple clock dividers with the same divisor are restarted simultaneously, by writing multiple 1 bits to this field, the execution clocks of those state machines will run in precise lockstep.
                              Note that setting/clearing SM_ENABLE does not stop the clock divider from running, so once multiple state machines' clocks are synchronised, it is safe to disable/reenable a state machine, whilst keeping the clock dividers in sync.
                              Note also that CLKDIV_RESTART can be written to whilst the state machine is running, and this is useful to resynchronise clock dividers after the divisors (SMx_CLKDIV) have been changed on-the-fly.
            index: 8
            width: 4
            read: true
            write: true
      - name: FSTAT
        type: uint32_t
        expected_size: 4
        expected_offset: 4
        const: true
        description: |-
          (read-only) FIFO status register
        fields:
          - name: RXFULL
            description: |-
              State machine RX FIFO is full
            index: 0
            width: 4
            read: true
            write: false
          - name: RXEMPTY
            description: |-
              State machine RX FIFO is empty
            index: 8
            width: 4
            read: true
            write: false
          - name: TXFULL
            description: |-
              State machine TX FIFO is full
            index: 16
            width: 4
            read: true
            write: false
          - name: TXEMPTY
            description: |-
              State machine TX FIFO is empty
            index: 24
            width: 4
            read: true
            write: false
      - name: FDEBUG
        type: uint32_t
        expected_size: 4
        expected_offset: 8
        description: |-
          (read-write) FIFO debug register
        fields:
          - name: RXSTALL
            description: |-
              State machine has stalled on full RX FIFO during a blocking PUSH, or an IN with autopush enabled. This flag is also set when a nonblocking PUSH to a full FIFO took place, in which case the state machine has dropped data. Write 1 to clear.
            index: 0
            width: 4
            read: true
            write: true
          - name: RXUNDER
            description: |-
              RX FIFO underflow (i.e. read-on-empty by the system) has occurred. Write 1 to clear. Note that read-on-empty does not perturb the state of the FIFO in any way, but the data returned by reading from an empty FIFO is undefined, so this flag generally only becomes set due to some kind of software error.
            index: 8
            width: 4
            read: true
            write: true
          - name: TXOVER
            description: |-
              TX FIFO overflow (i.e. write-on-full by the system) has occurred. Write 1 to clear. Note that write-on-full does not alter the state or contents of the FIFO in any way, but the data that the system attempted to write is dropped, so if this flag is set, your software has quite likely dropped some data on the floor.
            index: 16
            width: 4
            read: true
            write: true
          - name: TXSTALL
            description: |-
              State machine has stalled on empty TX FIFO during a blocking PULL, or an OUT with autopull enabled. Write 1 to clear.
            index: 24
            width: 4
            read: true
            write: true
      - name: FLEVEL
        type: uint32_t
        expected_size: 4
        expected_offset: 12
        const: true
        description: |-
          (read-only) FIFO levels
        fields:
          - name: TX0
            index: 0
            width: 4
            read: true
            write: false
          - name: RX0
            index: 4
            width: 4
            read: true
            write: false
          - name: TX1
            index: 8
            width: 4
            read: true
            write: false
          - name: RX1
            index: 12
            width: 4
            read: true
            write: false
          - name: TX2
            index: 16
            width: 4
            read: true
            write: false
          - name: RX2
            index: 20
            width: 4
            read: true
            write: false
          - name: TX3
            index: 24
            width: 4
            read: true
            write: false
          - name: RX3
            index: 28
            width: 4
            read: true
            write: false
      - name: TXF
        type: uint32_t
        array_length: 4
        expected_size: 16
        expected_offset: 16
        description: |-
          (read-write) Direct write access to the TX FIFO for this state machine. Each write pushes one word to the FIFO. Attempting to write to a full FIFO has no effect on the FIFO state or contents, and sets the sticky FDEBUG_TXOVER error flag for this FIFO.
      - name: RXF
        type: uint32_t
        expected_size: 16
        array_length: 4
        expected_offset: 32
        description: |-
          (read-write) Direct read access to the RX FIFO for this state machine. Each read pops one word from the FIFO. Attempting to read from an empty FIFO has no effect on the FIFO state, and sets the sticky FDEBUG_RXUNDER error flag for this FIFO. The data returned to the system on a read from an empty FIFO is undefined.
      - name: IRQ
        type: uint32_t
        expected_size: 4
        expected_offset: 48
        description: |-
          (read-write) State machine IRQ flags register. Write 1 to clear. There are 8 state machine IRQ flags, which can be set, cleared, and waited on by the state machines. There's no fixed association between flags and state machines -- any state machine can use any flag.
                      Any of the 8 flags can be used for timing synchronisation between state machines, using IRQ and WAIT instructions. The lower four of these flags are also routed out to system-level interrupt requests, alongside FIFO status interrupts -- see e.g. IRQ0_INTE.
        fields:
          - name: IRQ
            index: 0
            width: 8
            read: true
            write: true
      - name: IRQ_FORCE
        type: uint32_t
        expected_size: 4
        expected_offset: 52
        description: |-
          (write-only) Writing a 1 to each of these bits will forcibly assert the corresponding IRQ. Note this is different to the INTF register: writing here affects PIO internal state. INTF just asserts the processor-facing IRQ signal for testing ISRs, and is not visible to the state machines.
        fields:
          - name: IRQ_FORCE
            index: 0
            width: 8
            read: false
            write: true
      - name: INPUT_SYNC_BYPASS
        type: uint32_t
        expected_size: 4
        expected_offset: 56
        description: |-
          (read-write) There is a 2-flipflop synchronizer on each GPIO input, which protects PIO logic from metastabilities. This increases input delay, and for fast synchronous IO (e.g. SPI) these synchronizers may need to be bypassed. Each bit in this register corresponds to one GPIO.
                      0 -> input is synchronized (default)
                      1 -> synchronizer is bypassed
                      If in doubt, leave this register as all zeroes.
      - name: DBG_PADOUT
        type: uint32_t
        expected_size: 4
        expected_offset: 60
        description: |-
          (read-write) Read to sample the pad output values PIO is currently driving to the GPIOs. On RP2040 there are 30 GPIOs, so the two most significant bits are hardwired to 0.
      - name: DBG_PADOE
        type: uint32_t
        expected_size: 4
        expected_offset: 64
        description: |-
          (read-write) Read to sample the pad output enables (direction) PIO is currently driving to the GPIOs. On RP2040 there are 30 GPIOs, so the two most significant bits are hardwired to 0.
      - name: DBG_CFGINFO
        type: uint32_t
        expected_size: 4
        expected_offset: 68
        const: true
        description: |-
          (read-only) The PIO hardware has some free parameters that may vary between chip products.
                      These should be provided in the chip datasheet, but are also exposed here.
        fields:
          - name: FIFO_DEPTH
            description: |-
              The depth of the state machine TX/RX FIFOs, measured in words.
                              Joining fifos via SHIFTCTRL_FJOIN gives one FIFO with double
                              this depth.
            index: 0
            width: 6
            read: true
            write: false
          - name: SM_COUNT
            description: |-
              The number of state machines this PIO instance is equipped with.
            index: 8
            width: 4
            read: true
            write: false
          - name: IMEM_SIZE
            description: |-
              The size of the instruction memory, measured in units of one instruction
            index: 16
            width: 6
            read: true
            write: false
      - name: INSTR_MEM
        type: uint32_t
        expected_size: 128
        array_length: 32
        expected_offset: 72
        description: |-
          (write-only) Write-only access to instruction memory location N
      - name: SM
        type: pio_sm
        expected_offset: 200
        expected_size: 96
        array_length: 4
      - name: INTR
        type: uint32_t
        expected_size: 4
        expected_offset: 296
        const: true
        description: |-
          (read-only) Raw Interrupts
        fields:
          - name: SM0_RXNEMPTY
            index: 0
            width: 1
            read: true
            write: false
          - name: SM1_RXNEMPTY
            index: 1
            width: 1
            read: true
            write: false
          - name: SM2_RXNEMPTY
            index: 2
            width: 1
            read: true
            write: false
          - name: SM3_RXNEMPTY
            index: 3
            width: 1
            read: true
            write: false
          - name: SM0_TXNFULL
            index: 4
            width: 1
            read: true
            write: false
          - name: SM1_TXNFULL
            index: 5
            width: 1
            read: true
            write: false
          - name: SM2_TXNFULL
            index: 6
            width: 1
            read: true
            write: false
          - name: SM3_TXNFULL
            index: 7
            width: 1
            read: true
            write: false
          - name: SM0
            index: 8
            width: 1
            read: true
            write: false
          - name: SM1
            index: 9
            width: 1
            read: true
            write: false
          - name: SM2
            index: 10
            width: 1
            read: true
            write: false
          - name: SM3
            index: 11
            width: 1
            read: true
            write: false
      - name: IRQS
        type: pio_interrupt_cluster
        expected_offset: 300
        expected_size: 24
        array_length: 2
