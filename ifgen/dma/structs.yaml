---
structs:
  dma:
    description: |-
      DMA with separate read and write masters
    instances:
      - name: DMA
        address: '0x50000000'
    fields:
      - name: CONTROL
        type: dma_control
        array_length: &max_channels 16
        expected_size: &block_size 1024
        expected_offset: 0

      - name: INTR
        type: uint32_t
        expected_size: 4
        expected_offset: 1024
        description: |-
          (read-write) Interrupt Status (raw)
        fields:
          - name: INTR
            description: |-
              Raw interrupt status for DMA Channels 0..15. Bit n corresponds to channel n. Ignores any masking or forcing. Channel interrupts can be cleared by writing a bit mask to INTR, INTS0 or INTS1.
                              Channel interrupts can be routed to either of two system-level IRQs based on INTE0 and INTE1.
                              This can be used vector different channel interrupts to different ISRs: this might be done to allow NVIC IRQ preemption for more time-critical channels, or to spread IRQ load across different cores.
                              It is also valid to ignore this behaviour and just use INTE0/INTS0/IRQ 0.
            index: 0
            width: 16
            read: true
            write: true
      - name: INT0
        type: interrupt_cluster
        expected_size: 12
        expected_offset: 1028
      - name: INT1
        type: interrupt_cluster
        expected_size: 12
        expected_offset: 1044
      - name: TIMER0
        type: uint32_t
        expected_size: 4
        expected_offset: 1056
        description: |-
          (read-write) Pacing (X/Y) Fractional Timer
                      The pacing timer produces TREQ assertions at a rate set by ((X/Y) * sys_clk). This equation is evaluated every sys_clk cycles and therefore can only generate TREQs at a rate of 1 per sys_clk (i.e. permanent TREQ) or less.
        fields:
          - name: Y
            description: |-
              Pacing Timer Divisor. Specifies the Y value for the (X/Y) fractional timer.
            index: 0
            width: 16
            read: true
            write: true
          - name: X
            description: |-
              Pacing Timer Dividend. Specifies the X value for the (X/Y) fractional timer.
            index: 16
            width: 16
            read: true
            write: true
      - name: TIMER1
        type: uint32_t
        expected_size: 4
        expected_offset: 1060
        description: |-
          (read-write) Pacing (X/Y) Fractional Timer
                      The pacing timer produces TREQ assertions at a rate set by ((X/Y) * sys_clk). This equation is evaluated every sys_clk cycles and therefore can only generate TREQs at a rate of 1 per sys_clk (i.e. permanent TREQ) or less.
        fields:
          - name: Y
            description: |-
              Pacing Timer Divisor. Specifies the Y value for the (X/Y) fractional timer.
            index: 0
            width: 16
            read: true
            write: true
          - name: X
            description: |-
              Pacing Timer Dividend. Specifies the X value for the (X/Y) fractional timer.
            index: 16
            width: 16
            read: true
            write: true
      - name: TIMER2
        type: uint32_t
        expected_size: 4
        expected_offset: 1064
        description: |-
          (read-write) Pacing (X/Y) Fractional Timer
                      The pacing timer produces TREQ assertions at a rate set by ((X/Y) * sys_clk). This equation is evaluated every sys_clk cycles and therefore can only generate TREQs at a rate of 1 per sys_clk (i.e. permanent TREQ) or less.
        fields:
          - name: Y
            description: |-
              Pacing Timer Divisor. Specifies the Y value for the (X/Y) fractional timer.
            index: 0
            width: 16
            read: true
            write: true
          - name: X
            description: |-
              Pacing Timer Dividend. Specifies the X value for the (X/Y) fractional timer.
            index: 16
            width: 16
            read: true
            write: true
      - name: TIMER3
        type: uint32_t
        expected_size: 4
        expected_offset: 1068
        description: |-
          (read-write) Pacing (X/Y) Fractional Timer
                      The pacing timer produces TREQ assertions at a rate set by ((X/Y) * sys_clk). This equation is evaluated every sys_clk cycles and therefore can only generate TREQs at a rate of 1 per sys_clk (i.e. permanent TREQ) or less.
        fields:
          - name: Y
            description: |-
              Pacing Timer Divisor. Specifies the Y value for the (X/Y) fractional timer.
            index: 0
            width: 16
            read: true
            write: true
          - name: X
            description: |-
              Pacing Timer Dividend. Specifies the X value for the (X/Y) fractional timer.
            index: 16
            width: 16
            read: true
            write: true
      - name: MULTI_CHAN_TRIGGER
        type: uint32_t
        expected_size: 4
        expected_offset: 1072
        description: |-
          (read-write) Trigger one or more channels simultaneously
        fields:
          - name: MULTI_CHAN_TRIGGER
            description: |-
              Each bit in this register corresponds to a DMA channel. Writing a 1 to the relevant bit is the same as writing to that channel's trigger register; the channel will start if it is currently enabled and not already busy.
            index: 0
            width: 16
            read: true
            write: true
      - name: SNIFF_CTRL
        type: uint32_t
        expected_size: 4
        expected_offset: 1076
        description: |-
          (read-write) Sniffer Control
        fields:
          - name: EN
            description: |-
              Enable sniffer
            index: 0
            width: 1
            read: true
            write: true
          - name: DMACH
            description: |-
              DMA channel for Sniffer to observe
            index: 1
            width: 4
            read: true
            write: true
          - name: CALC
            index: 5
            width: 4
            read: true
            write: true
            type: DMA_SNIFF_CTRL_CALC
          - name: BSWAP
            description: |-
              Locally perform a byte reverse on the sniffed data, before feeding into checksum.
                              Note that the sniff hardware is downstream of the DMA channel byteswap performed in the read master: if channel CTRL_BSWAP and SNIFF_CTRL_BSWAP are both enabled, their effects cancel from the sniffer's point of view.
            index: 9
            width: 1
            read: true
            write: true
          - name: OUT_REV
            description: |-
              If set, the result appears bit-reversed when read. This does not affect the way the checksum is calculated; the result is transformed on-the-fly between the result register and the bus.
            index: 10
            width: 1
            read: true
            write: true
          - name: OUT_INV
            description: |-
              If set, the result appears inverted (bitwise complement) when read. This does not affect the way the checksum is calculated; the result is transformed on-the-fly between the result register and the bus.
            index: 11
            width: 1
            read: true
            write: true
      - name: SNIFF_DATA
        type: uint32_t
        expected_size: 4
        expected_offset: 1080
        description: |-
          (read-write) Data accumulator for sniff hardware
                      Write an initial seed value here before starting a DMA transfer on the channel indicated by SNIFF_CTRL_DMACH. The hardware will update this register each time it observes a read from the indicated channel. Once the channel completes, the final result can be read from this register.
      - name: FIFO_LEVELS
        type: uint32_t
        expected_size: 4
        expected_offset: 1088
        const: true
        description: |-
          (read-only) Debug RAF, WAF, TDF levels
        fields:
          - name: TDF_LVL
            description: |-
              Current Transfer-Data-FIFO fill level
            index: 0
            width: 8
            read: true
            write: false
          - name: WAF_LVL
            description: |-
              Current Write-Address-FIFO fill level
            index: 8
            width: 8
            read: true
            write: false
          - name: RAF_LVL
            description: |-
              Current Read-Address-FIFO fill level
            index: 16
            width: 8
            read: true
            write: false
      - name: CHAN_ABORT
        type: uint32_t
        expected_size: 4
        expected_offset: 1092
        description: |-
          (read-write) Abort an in-progress transfer sequence on one or more channels
        fields:
          - name: CHAN_ABORT
            description: |-
              Each bit corresponds to a channel. Writing a 1 aborts whatever transfer sequence is in progress on that channel. The bit will remain high until any in-flight transfers have been flushed through the address and data FIFOs.
                              After writing, this register must be polled until it returns all-zero. Until this point, it is unsafe to restart the channel.
            index: 0
            width: 16
            read: true
            write: true
      - name: N_CHANNELS
        type: uint32_t
        expected_size: 4
        expected_offset: 1096
        const: true
        description: |-
          (read-only) The number of channels this DMA instance is equipped with. This DMA supports up to 16 hardware channels, but can be configured with as few as one, to minimise silicon area.
        fields:
          - name: N_CHANNELS
            index: 0
            width: 5
            read: true
            write: false

      - name: DEBUG
        type: dma_debug
        array_length: *max_channels
        expected_size: *block_size
        expected_offset: 2048
